<div class="launch-group-template-container">

  <div class="expand-config">
    <div class="expand-title"><span>配置区</span>
      <div class="panel-header-right-wrapper">
        <div class="account-count-info-wrapper">
          <div class="ad-formula">
            <div class="ad-formula-item"><span
              class="value">{{isSettingDrawerEdit.audience ? resultData.template_struct.adgroup.audience_template_id_lst['all'].length : 0}}</span><span
              class="label">定向</span></div>
            <div class="ad-formula-sign"> x</div>
            <div class="ad-formula-item">
              <span class="value">{{isSettingDrawerEdit.creative ? resultData.template_struct.material.material_type_lst['all'].materials.length : 0}}</span>
              <span class="label">创意组</span>
            </div>
            <ng-container  *ngIf="resultData.template_struct.campaign.promotion_way!=='SIMPLE'">
              <div class="ad-formula-sign"> x</div>
              <div class="ad-formula-item">
                <span class="value">{{isSettingDrawerEdit.tags ? resultData.template_struct.creative.industry_keywords_lst.length : 0}}</span>
                <span class="label">分类标签</span>
              </div>
            </ng-container>
            <div class="ad-formula-sign"> =</div>
            <div class="ad-formula-item"><span
              class="value">{{adgroupNum}}</span><span
              class="label">广告计划</span></div>
            <div class="ad-formula-sign" style="display: none;"> =</div>
          </div>
          <!--          <div class="collapse-icon"><i class="el-icon-caret-bottom" style="cursor: pointer;"></i></div>-->
        </div>
      </div>
    </div>
    <div class="expand-container">
      <div class="setting-head">
        <div class="setting-basic">
          <div class="flex-box">
            <div class="key-text">营销目标 :</div>
            <div
              class="content">{{resultData.template_struct.campaign['marketing_goal'] === 'VIDEO_PROM_GOODS' ? '短视频/图片带货' : '直播带货'}}</div>
          </div>
          <div class="flex-box">
            <div class="key-text">推广方式 :</div>
            <div class="content">{{resultData.template_struct.campaign['promotion_way'] === 'STANDARD' ? '专业推广' : '极速推广'}}</div>
          </div>
        </div>
        <div class="filter-selectors">
          <div class="selector">
            <span class="selector-label">媒体账户</span>
            <nz-select class="w240"
                       [nzPlaceHolder]="'请选择帐户'"
                       [nzAllowClear]="true"
                       (nzOpenChange)="changeAccount($event)"
                       [(ngModel)]="chanPubId"
                       nzShowSearch>
              <nz-option
                *ngFor="let option of accountsList"
                [nzLabel]="option.pub_account_name"
                [nzValue]="option.chan_pub_id">
              </nz-option>
            </nz-select>
          </div>
          <ng-container *ngFor="let item of curAccountList">
            <div class="selector">
              <span class="selector-label">抖音号</span>
              <nz-select class="w240"
                         [nzPlaceHolder]="'请选择抖音号'"
                         [nzAllowClear]="true"
                         [(ngModel)]="resultData.template_struct.adgroup.product_aweme_id_lst[item.chan_pub_id]['aweme_id']"
                         (ngModelChange)="changeAweme($event,item.awemeList)"
                         nzShowSearch>
                <nz-option
                  *ngFor="let option of item.awemeList"
                  [nzLabel]="option.name"
                  [nzValue]="option.aweme_id">
                </nz-option>
              </nz-select>
            </div>
            <div class="selector" *ngIf="resultData.template_struct.campaign.marketing_goal==='VIDEO_PROM_GOODS'">
              <span class="selector-label">商品</span>
              <div class="w240 selector-info" (click)="openSingelSettingDraw('product')">{{resultData.template_struct.adgroup.product_info[0]?resultData.template_struct.adgroup.product_info[0]['product_name']:'请选择商品'}}</div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
    <div>
      <ul class="info-list-wrap">
        <li class="ad">
          <ul class="list-head" style="height: 36px;">
            <li class="name-warp">广告基础信息</li>
            <li class="btn-wrap"><a (click)="openSingelSettingDraw('adgroup')">编辑</a></li>
          </ul>
          <div class="ad-info-content" [ngClass]="{'align-center':!isSettingDrawerEdit.adgroup}">
            <ng-container *ngIf="isSettingDrawerEdit.adgroup">
              <div class="flex-box">
                <div class="key-text">模板名称 :</div>
                <div class="content">{{resultData.project_template_name}}</div>
              </div>
              <ng-container *ngFor="let item of adSettingInfo">
                <div class="flex-box">
                  <div class="key-text">{{item.label}} :</div>
                  <div
                    class="content">{{item.isNeedChange ? item.keyMap[resultData.template_struct[item.parent][item.key]] : resultData.template_struct[item.parent][item.key]}}
                    <span
                      *ngIf="item.add&&resultData.template_struct[item.parent][item.key]!=='BUDGET_MODE_INFINITE'"> {{resultData.template_struct[item.parent][item.add]}}
                      元</span> <span *ngIf="item.key==='cpa_bid'">元</span>
                  </div>
                </div>
              </ng-container>
            </ng-container>
            <div *ngIf="!isSettingDrawerEdit.adgroup" class="empty-wrap" style="top: -2.2px;"
                 (click)="openSingelSettingDraw('adgroup')">
              <p class="active">
                <span class="active-icon mb8"><i nz-icon nzType="container" nzTheme="outline"></i></span>
                暂无信息 , 点击编辑
              </p>
            </div>
          </div>
        </li>
        <li class="packages">
          <ul class="list-head">
            <li class="name-warp">
              定向（{{isSettingDrawerEdit.audience ? resultData.template_struct.adgroup.audience_template_id_lst['all'].length : 0}}
              ）
            </li>
            <li class="btn-wrap"><a (click)="openSingelSettingDraw('audience')">编辑</a></li>
          </ul>
          <div class="ad-info-content" [ngClass]="{'align-center':!isSettingDrawerEdit.audience}">
            <ng-container *ngIf="isSettingDrawerEdit.audience">
              <div class="opr-select-panel"
                   *ngFor="let item of resultData.template_struct.adgroup.audience_template_id_lst['all'];let index=index;">
                <div class="selected-item cursor-pointer">
                  <div class="item-text" style="max-width: calc(100% - 20px);" nz-tooltip
                       [nzTooltipTitle]="this.targetListMap[item]">{{this.targetListMap[item]}}</div>
                  <div class="close-icon close-icon-hide" (click)="deleteSignalTarget(index)"><i nz-icon nzType="close"
                                                                                                 nzTheme="outline"></i>
                  </div>
                </div>
              </div>
            </ng-container>
            <div *ngIf="!isSettingDrawerEdit.audience" class="empty-wrap" style="top: -2.2px;"
                 (click)="openSingelSettingDraw('audience')">
              <p class="active">
                <span class="active-icon mb8"><i nz-icon nzType="container" nzTheme="outline"></i></span>
                暂无信息 , 点击编辑
              </p>
            </div>
          </div>
        </li>
        <li class="creative">
          <ul class="list-head">
            <li class="name-warp" style="min-width: 68px;">
              创意组（{{isSettingDrawerEdit.creative ? resultData.template_struct.material.material_type_lst['all'].materials.length : 0}}
              ）
            </li>
            <li class="btn-wrap"><a (click)="openSingelSettingDraw('creative')">编辑</a></li>
          </ul>
          <div class="ad-info-content" [ngClass]="{'align-center':!isSettingDrawerEdit.creative}">
            <ng-container *ngIf="isSettingDrawerEdit.creative">
              <div class="creative-group-box">
                <div class="creative-group"
                     *ngFor="let group of resultData.template_struct.material.material_type_lst['all'].materials">
                  <ng-container *ngFor="let limit of group.limit;let idex=index">
                    <div *ngFor="let material of limit.list;let idx=index" class="creative creative-video">
                      <!--                        <i class="mg-icon-preview" nz-icon nzType="play-circle" nzTheme="outline"></i>-->
                      <div class="el-image creative-cover">
                        <img [src]="material['preview_img']">
                      </div>
                      <div class="creative-mask" nz-popover [nzPopoverContent]="contentTemplate"
                           [nzPopoverOverlayClassName]="'image-drop-class'" nzPopoverTrigger="click">
                        <i class="mg-icon-close" nz-icon nzType="close" nzTheme="outline"
                           (click)="clearSingleSelected(limit.list,idx,'material')"></i>
                      </div>
                      <ng-template #contentTemplate>
                        <div class="image-cnt-drop">
                          <img *ngIf="limit.type==='image'" [src]="material['preview_img']">
                          <a *ngIf="limit.type==='video'" target="_blank" [href]="material['preview_video']">
                            <video poster="{{material['preview_img']}}" [src]="material['preview_video']"
                                   controls="controls" controlslist="nodownload"></video>
                          </a>
                        </div>
                      </ng-template>
                    </div>
                  </ng-container>
                </div>
              </div>
            </ng-container>
            <div *ngIf="!isSettingDrawerEdit.creative" class="empty-wrap" style="top: -2.2px;"
                 (click)="openSingelSettingDraw('creative')">
              <p class="active">
                <span class="active-icon mb8"><i nz-icon nzType="container" nzTheme="outline"></i></span>
                暂无信息 , 点击编辑
              </p>
            </div>
          </div>
        </li>
        <li class="text is-sample-text">
          <ul class="list-head">
            <li class="name-warp">
              创意标题（{{isSettingDrawerEdit.title ? resultData.template_struct.material.material_type_lst['all'].titles.length : 0}}
              ）
            </li>
            <li class="btn-wrap"><a (click)="openSingelSettingDraw('title')">编辑</a></li>
          </ul>
          <div class="ad-info-content" [ngClass]="{'align-center':!isSettingDrawerEdit.title}">
            <ng-container *ngIf="isSettingDrawerEdit.title">
              <div class="opr-select-panel"
                   *ngFor="let title of resultData.template_struct.material.material_type_lst['all'].titles;let index=index;">
                <div class="selected-item cursor-pointer">
                  <div class="item-text" style="max-width: calc(100% - 20px);" nz-tooltip
                       [nzTooltipTitle]="title">{{title}}</div>
                  <div class="close-icon close-icon-hide"
                       (click)="clearSingleSelected(resultData.template_struct.material.material_type_lst['all'].titles,index,'title')">
                    <i nz-icon nzType="close" nzTheme="outline"></i></div>
                </div>
              </div>
            </ng-container>
            <div *ngIf="!isSettingDrawerEdit.title" class="empty-wrap" style="top: -2.2px;"  (click)="openSingelSettingDraw('title')">
              <p class="active">
                <span class="active-icon mb8"><i nz-icon nzType="container" nzTheme="outline"></i></span>
                暂无信息 , 点击编辑
              </p>
            </div>
          </div>
        </li>
        <li class="categories-common categories-label" *ngIf="resultData.template_struct.campaign.promotion_way!=='SIMPLE'">
          <ul class="list-head">
            <li class="name-warp">分类标签（{{isSettingDrawerEdit.tags ? resultData.template_struct.creative.industry_keywords_lst.length : 0}}）</li>
            <li class="btn-wrap"><a (click)="openSingelSettingDraw('tags')">编辑</a></li>
          </ul>
          <div class="ad-info-content" [ngClass]="{'align-center':!isSettingDrawerEdit.tags}">
            <ng-container *ngIf="isSettingDrawerEdit.tags">
              <div class="opr-select-panel"
                   *ngFor="let item of resultData.template_struct.creative.industry_keywords_lst;let index=index;">
                <div class="selected-item cursor-pointer">
                  <div class="item-text" style="max-width: calc(100% - 20px);" nz-tooltip
                       [nzTooltipTitle]="item.name">{{item.name}}</div>
                  <div class="close-icon close-icon-hide"
                       (click)="deleteCreativeTag(index)">
                    <i nz-icon nzType="close" nzTheme="outline"></i></div>
                </div>
              </div>
            </ng-container>
            <div *ngIf="!isSettingDrawerEdit.tags" class="empty-wrap" style="top: -2.2px;"  (click)="openSingelSettingDraw('tags')">
              <p class="active">
                <span class="active-icon mb8"><i nz-icon nzType="container" nzTheme="outline"></i></span>
                暂无信息 , 点击编辑
              </p>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>
  <div class="drawer-confirmbox pr20">
    <button class="ml8" nz-button [nzType]="'default'" nzSize="small" (click)="doCancel()">
      <span>取消</span>
    </button>
    <button class="ml8 mr4" nz-button [nzType]="'primary'" nzSize="small" (click)="doSave()">
      <span>完成</span>
    </button>
  </div>

</div>
<!--广告基础信息-->
<nz-drawer *ngIf="settingDrawerObj.adgroup"
           [nzVisible]="settingDrawerObj.adgroup"
           [nzWidth]="'1200px'"
           nzPlacement="right"
           nzTitle="广告基础信息"
           (nzOnClose)="closeSingelSettingDraw('adgroup')"
>
  <div class="drawer-content">
    <div class="form-block-title">投放设置</div>
    <div id="template_name" class="lab-row mb20 pl20 w100p">
      <label><span class="redStart">*</span>模板名称:</label>
      <div>
        <input class="w_full ml8" nz-input [(ngModel)]="defaultData.project_template_name"
               (ngModelChange)="getItemErrorTip('project_template_name', defaultData.project_template_name)"
               placeholder="请输入模板名称"/>
        <div class="error-tip mt5 ml8" *ngIf="checkErrorTip.project_template_name.is_show">
          <i nz-icon nzType="close-circle" nzTheme="outline" style="color: red" class="mr5"></i>
          <span style="color: red;">{{ checkErrorTip.project_template_name.tip_text }}</span>
        </div>
      </div>
    </div>
    <div id="adgroup_name" class="lab-row mb20 pl20 w100p">
      <label><span class="redStart">*</span>广告组名称:</label>
      <div>
        <input class="w_full ml8" #curAdgroupTextArea [(ngModel)]="defaultData.template_struct.adgroup.ad_name"
               nz-input
               (ngModelChange)="getItemErrorTip('ad_name', defaultData.template_struct.adgroup.ad_name)"
               placeholder="请输入广告组名称"/>
        <div class="item-body mt10">
          <div class="tag ml8">
            <span class="word-name">占位符：</span>
            <ng-container *ngFor="let word of adgroupWordList;let i = index;">
                      <span class="tag-word mb8 mr10" (click)="addTags(word,'adgroup')"><i nz-icon nzType="plus"
                                                                                           nzTheme="outline"
                                                                                           class="mr5"></i>{{ word }}</span>
            </ng-container>
          </div>
        </div>
        <div class="error-tip mt5 ml8" *ngIf="checkErrorTip.ad_name.is_show">
          <i nz-icon nzType="close-circle" nzTheme="outline" style="color: red" class="mr5"></i>
          <span style="color: red;">{{ checkErrorTip.ad_name.tip_text }}</span>
        </div>
      </div>

    </div>
    <div class="lab-row mb20 w100p pl20">
      <label id="bid_setting">投放方式:</label>
      <div>
        <nz-radio-group
          class="ml8"
          [(ngModel)]="defaultData.template_struct.adgroup.smart_bid_type"
          (ngModelChange)="changeSmartBidType($event)">
          <label nz-radio-button [nzValue]="'SMART_BID_CUSTOM'">
            <span>控成本投放</span>
          </label>
          <label nz-radio-button [nzValue]="'SMART_BID_CONSERVATIVE'">
            <span>放量投放</span>
          </label>
        </nz-radio-group>
        <div class="ml8 mt10" *ngIf="defaultData.template_struct.campaign.promotion_way==='STANDARD'">
          <label nz-checkbox [nzChecked]="defaultData.template_struct.adgroup.flow_control_mode=='FLOW_CONTROL_MODE_SMOOTH'" (nzCheckedChange)="changeCheckFlow($event)">严格控制成本上限</label>
        </div>
      </div>
    </div>
    <div class="lab-row pl20 mb20 w100p"
         *ngIf="defaultData.template_struct.adgroup.smart_bid_type === 'SMART_BID_CUSTOM'&&defaultData.template_struct.adgroup.flow_control_mode!=='FLOW_CONTROL_MODE_SMOOTH'">
      <label><span class="redStart">*</span>投放速度:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="defaultData.template_struct.adgroup.flow_control_mode">
        <label nz-radio-button [nzValue]="'FLOW_CONTROL_MODE_FAST'">
          <span>尽快投放</span>
        </label>
        <label *ngIf="defaultData.template_struct.campaign.promotion_way==='STANDARD'"
          nz-radio-button [nzValue]="'FLOW_CONTROL_MODE_BALANCE'">
          <span>均匀投放</span>
        </label>
      </nz-radio-group>
    </div>
    <!--优化目标-->
    <div class="lab-row pl20 mb20">
      <label>优化目标:</label>
      <div>
        <nz-radio-group
          class="ml8"
          [(ngModel)]="defaultData.template_struct.adgroup.external_action"
        >
          <ng-container *ngFor="let option of structConfig['adgroup']['external_action']['sub']">
            <label *ngIf="option['marketing_goal']===defaultData.template_struct.campaign.marketing_goal"
                   nz-radio-button [nzValue]="option.value">
              <span>{{option.label}}</span>
            </label>
          </ng-container>
        </nz-radio-group>
        <div class="mt10 ml8"
             *ngIf="defaultData.template_struct.campaign.promotion_way==='STANDARD'&&defaultData.template_struct.campaign.marketing_goal==='LIVE_PROM_GOODS'&&(defaultData.template_struct.adgroup.smart_bid_type!=='SMART_BID_CUSTOM'||defaultData.template_struct.adgroup.flow_control_mode!=='FLOW_CONTROL_MODE_SMOOTH')&&(defaultData.template_struct.adgroup.external_action==='AD_CONVERT_TYPE_LIVE_ENTER_ACTION'||defaultData.template_struct.adgroup.external_action==='AD_CONVERT_TYPE_LIVE_CLICK_PRODUCT_ACTION')">
          <label nz-checkbox [(ngModel)]="deepChecked" (ngModelChange)="changeDeepChecked($event)">同时优化「 直播间下单
            」</label>
        </div>
      </div>
    </div>
    <div class="lab-row mb20 pl20 w100p">
      <label><span class="redStart">*</span>预算类型:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="defaultData.template_struct.adgroup.budget_mode">
        <ng-container>
          <label nz-radio-button nzValue="BUDGET_MODE_DAY"
                 [nzDisabled]="defaultData.template_struct.campaign.promotion_way==='SIMPLE'&&defaultData.template_struct.campaign.marketing_goal==='LIVE_PROM_GOODS'">
            <span>日预算</span>
          </label>
          <label nz-radio-button nzValue="BUDGET_MODE_TOTAL"
                 [nzDisabled]="defaultData.template_struct.campaign.promotion_way==='SIMPLE'&&defaultData.template_struct.campaign.marketing_goal==='VIDEO_PROM_GOODS'">
            <span>总预算</span>
          </label>
        </ng-container>
      </nz-radio-group>
    </div>
    <div class="lab-row pl20 mb20 w100p">
      <label><span class="redStart">*</span>预算:</label>
      <div>
        <nz-input-number
          class="w200 ml8 mr8"
          [nzMin]="300"
          [nzMax]="9999999.99"
          [nzPrecision]="2"
          [(ngModel)]="defaultData.template_struct.adgroup.budget"
          (ngModelChange)="getItemErrorTip('budget', defaultData.template_struct.adgroup.budget)">
        </nz-input-number>
        <div class="lab-tip mt5 ml8">
          <i nz-icon nzType="exclamation-circle" nzTheme="outline" style="color: rgb(250, 173, 20)"
             class="mr5"></i>
          <span>取值范围: 300-9999999.99</span>
        </div>
        <div class="error-tip mt5 ml8" *ngIf="checkErrorTip.budget.is_show">
          <i nz-icon nzType="close-circle" nzTheme="outline" style="color: red" class="mr5"></i>
          <span style="color: red;">{{ checkErrorTip.budget.tip_text }}</span>
        </div>
      </div>
    </div>
    <div class="lab-row pl20 mb20 w100p"
         *ngIf="defaultData.template_struct.adgroup.smart_bid_type === 'SMART_BID_CUSTOM'">
      <label><span class="redStart">*</span>出价:</label>
      <div>
        <nz-input-number class="w200 ml8"
                         [(ngModel)]="defaultData.template_struct.adgroup.cpa_bid"
                         (ngModelChange)="getItemErrorTip('cpa_bid', defaultData.template_struct.adgroup.cpa_bid)"
                         [nzMin]="0.1" [nzMax]="10000" [nzStep]="1"></nz-input-number>
        <span class="ml20">元</span>
        <div class="lab-tip mt5 ml8">
          <i nz-icon nzType="exclamation-circle" nzTheme="outline" style="color: rgb(250, 173, 20)"
             class="mr5"></i>
          <span>取值范围: 0.1-日预算, 最高不超过10000元</span>
        </div>
        <div class="error-tip mt5 ml8" *ngIf="checkErrorTip.cpa_bid.is_show">
          <i nz-icon nzType="close-circle" nzTheme="outline" style="color: red" class="mr5"></i>
          <span style="color: red;">{{ checkErrorTip.cpa_bid.tip_text }}</span>
        </div>
      </div>
    </div>
    <div class="lab-row pl20 mb20 w100p">
      <label id="schedule_type">投放日期:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="defaultData.template_struct.adgroup.schedule_type"
      >
        <label nz-radio-button [nzValue]="'SCHEDULE_FROM_NOW'">
          <span>长期投放</span>
        </label>
        <label nz-radio-button [nzValue]="'SCHEDULE_START_END'"
               [nzDisabled]="defaultData.template_struct.adgroup.smart_bid_type === 'SMART_BID_CONSERVATIVE'">
          <span>设置开始和结束日期</span>
        </label>
<!--        <label-->
<!--          *ngIf="defaultData.template_struct.campaign.promotion_way==='SIMPLE'&&defaultData.template_struct.campaign.marketing_goal==='LIVE_PROM_GOODS'"-->
<!--          nz-radio-button [nzValue]="'SCHEDULE_TIME_FIXEDRANGE'">-->
<!--          <span>固定时长</span>-->
<!--        </label>-->
      </nz-radio-group>
      <div *ngIf="defaultData.template_struct.adgroup.schedule_type === 'SCHEDULE_START_END'">
        <nz-range-picker
          class="w300 ml8"
          [nzAllowClear]="false"
          [(ngModel)]="defaultData.template_struct.adgroup.time_range"
          [nzDisabledDate]="getDisableDate"
          [nzFormat]="'yyyy/MM/dd'">
        </nz-range-picker>
      </div>
    </div>
    <div class="lab-row pl20 mb20 w100p"
         *ngIf="defaultData.template_struct.adgroup.schedule_type === 'LIVE_PROM_GOODS'">
      <label><span class="redStart">*</span>投放时长:</label>
      <nz-input-number class="w200 ml8"
                       [(ngModel)]="defaultData.template_struct.adgroup.schedule_fixed_range" [nzMin]="0.5"
                       [nzMax]="24" [nzStep]=".5"></nz-input-number>
      <span class="ml4">小时 最多不超过24小时</span>
    </div>
    <div class="lab-row pl20 mb20 w100p">
      <label><span class="redStart">*</span>投放时段:</label>
      <div>
        <nz-radio-group class="ml8"
                        [(ngModel)]="defaultData.template_struct.adgroup.schedule_time_slt">
          <label nz-radio-button [nzValue]="'nolimt'">
            <span>不限</span>
          </label>
          <label nz-radio-button [nzValue]="'schedule_time'">
            <span>指定时段</span>
          </label>
        </nz-radio-group>
        <ng-container *ngIf="defaultData.template_struct.adgroup.schedule_time_slt === 'schedule_time'">
          <app-edit-schedule [outFormat]="'string'" [timeDimension]="0.5"
                             [parentTimeDate]="defaultData.template_struct.adgroup['schedule_time']"
                             [showCoefficient]="showCoefficient"
                             (dateSelected)="dateDate($event)"></app-edit-schedule>
        </ng-container>
      </div>
    </div>
    <div class="form-block-title">计划设置</div>
    <div class="lab-row mb20 pl20 w100p">
      <label><span class="redStart">*</span>计划选择:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="defaultData.template_struct.campaign.campaign_select"
      >
        <ng-container>
          <label nz-radio-button nzValue="create">
            <span>新建计划</span>
          </label>
          <!--                  <label nz-radio-button nzValue="exist" [nzDisabled]="true">-->
          <!--                    <span>已有计划</span>-->
          <!--                  </label>-->
        </ng-container>
      </nz-radio-group>
    </div>
    <div class="lab-row mb20 pl20 w100p">
      <label><span class="redStart">*</span>计划名称:</label>
      <div>
        <input #curCampaignTextArea class="w_full ml8"
               [(ngModel)]="defaultData.template_struct.campaign.campaign_name" nz-input
               (ngModelChange)="getItemErrorTip('campaign_name', defaultData.template_struct.campaign.campaign_name)"
               placeholder="请输入计划名称"/>
        <div class="item-body mt10">
          <div class="tag ml8">
            <span class="word-name">占位符：</span>
            <ng-container *ngFor="let word of campaignWordList;let i = index;">
                      <span class="tag-word mb8 mr10" (click)="addTags(word,'campaign')"><i nz-icon nzType="plus"
                                                                                            nzTheme="outline"
                                                                                            class="mr5"></i>{{ word }}</span>
            </ng-container>
          </div>
        </div>
        <div class="error-tip mt5 ml8" *ngIf="checkErrorTip.campaign_name.is_show">
          <i nz-icon nzType="close-circle" nzTheme="outline" style="color: red" class="mr5"></i>
          <span style="color: red;">{{ checkErrorTip.campaign_name.tip_text }}</span>
        </div>
      </div>
    </div>
    <div id="budget" class="lab-row mb20 pl20 w100p">
      <label><span class="redStart">*</span>预算:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="defaultData.template_struct.campaign.campaign_budget_mode"
      >
        <ng-container>
          <label nz-radio-button nzValue="BUDGET_MODE_INFINITE">
            <span>不限</span>
          </label>
          <label nz-radio-button nzValue="BUDGET_MODE_DAY">
            <span>日预算</span>
          </label>
        </ng-container>
      </nz-radio-group>
      <ng-container *ngIf="defaultData.template_struct.campaign.campaign_budget_mode === 'BUDGET_MODE_DAY'">
        <div>
          <nz-input-number class="ml20 mr10" [(ngModel)]="defaultData.template_struct.campaign.campaign_budget" [nzMin]="300"
                           [nzMax]="9999999.99" [nzStep]="1"
                           (ngModelChange)="getItemErrorTip('campaign_budget', defaultData.template_struct.campaign.campaign_budget)"></nz-input-number>
          元
          <i nz-icon nzType="exclamation-circle" nzTheme="outline" style="color: rgb(250, 173, 20)"
             class="ml5 mt5 mr5"></i>
          <span>取值范围: 300-9999999.99</span>
          <div class="error-tip mt5 ml8" *ngIf="checkErrorTip.campaign_budget.is_show">
            <i nz-icon nzType="close-circle" nzTheme="outline" style="color: red" class="mr5"></i>
            <span style="color: red;">{{ checkErrorTip.campaign_budget.tip_text }}</span>
          </div>
        </div>
      </ng-container>
    </div>

    <div class="form-block-title" *ngIf="defaultData.template_struct.campaign.promotion_way!=='SIMPLE'">推广卡片</div>
    <div id="card_template" class="lab-row pl20 mb20 w100p" *ngIf="defaultData.template_struct.campaign.promotion_way!=='SIMPLE'">
      <label><span class="redStart">*</span>是否使用推广卡片:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="defaultData.template_struct.promotion_card.isOpenCard"
        (ngModelChange)="changeUseCard($event)"
      >
        <label nz-radio-button [nzValue]="true">
          <span>是</span>
        </label>
        <label nz-radio-button
               [nzDisabled]="defaultData.template_struct.campaign.marketing_goal!=='VIDEO_PROM_GOODS'||defaultData.template_struct.campaign.promotion_way!=='SIMPLE'"
               [nzValue]="false">
          <span>否</span>
        </label>
      </nz-radio-group>
    </div>
    <ng-container *ngIf="defaultData.template_struct.promotion_card.isOpenCard">
      <div class="lab-row pl20 mb20 w100p">
        <label><span class="redStart">*</span>推广卡片主图来源:</label>
        <nz-radio-group
          class="ml8"
          [(ngModel)]="defaultData.template_struct.promotion_card.use_auto_create_product_image"
          (ngModelChange)="changeUseProductImg($event)"
        >
          <label nz-radio-button [nzValue]="'1'">
            <span>商品</span>
          </label>
          <label nz-radio-button [nzValue]="'0'">
            <span>自选</span>
          </label>
        </nz-radio-group>
      </div>
      <ng-container
        *ngIf="defaultData.template_struct.promotion_card.card_by_convert_channel && defaultData.template_struct.promotion_card.card_type_lst">
        <nz-tabset class="ml8 card-tab" [nzType]="'card'"
                   *ngIf="defaultData.template_struct.adgroup.product_info.length > 0"
                   [nzSelectedIndex]="curDeliveryIndex" (nzSelectedIndexChange)="changeCardTab($event)">
          <nz-tab class="mb20" *ngFor="let item of defaultData.template_struct.adgroup.product_info"
                  [nzTitle]="item.name">
            <div class="lab-row pl20 mb20 w100p">
              <label><span class="redStart">*</span>推广卡片:</label>
              <div class="promotion_card_wrapper">
                <div class="promotion_card">
                  <div class="promotion_card__left">
                    <img
                      [src]="defaultData.template_struct.promotion_card.card_type_lst[item.product_id]['promo_card_setting']['preview_img']"
                      alt="">
                    <div>
                      <div
                        style="font-size:16px">{{defaultData.template_struct.promotion_card.card_type_lst[item.product_id]['promo_card_setting']['product_description']}}</div>
                      <div class="promotion_card__left__selling">
                        <span>{{defaultData.template_struct.promotion_card.card_type_lst['all']['promo_card_setting']['product_points'][0].name}}</span>
                      </div>
                    </div>
                  </div>
                  <div class="promotion_card__right">
                    <div>{{defaultData.template_struct.promotion_card.card_type_lst[item.product_id]['promo_card_setting']['call_to_action']}}</div>
                  </div>
                </div>
                <div class="ml8">
                  <a *ngIf="isShowCardSetting" (click)="changeOpenCard(false)">收起</a>
                  <a *ngIf="!isShowCardSetting" (click)="changeOpenCard(true)">更改</a>
                </div>
              </div>
            </div>
            <app-card-template-section *ngIf="cardLoading"
                                       [promotionCard]="defaultData.template_struct.promotion_card.card_type_lst[item.product_id]"
                                       [actionList]="structConfig['creative']['promotion_card_action_button']['sub']"
                                       [checkError]="checkErrorTip.card_error_tip[item.product_id]"></app-card-template-section>
          </nz-tab>
        </nz-tabset>
      </ng-container>
      <ng-container
        *ngIf="!defaultData.template_struct.promotion_card.card_by_convert_channel &&defaultData.template_struct.promotion_card.card_type_lst['all']">
        <div class="lab-row pl20 mb20 w100p">
          <label><span class="redStart">*</span>推广卡片:</label>
          <div class="promotion_card_wrapper">
            <div class="promotion_card">
              <div class="promotion_card__left">
                <img
                  [src]="defaultData.template_struct.promotion_card.card_type_lst['all']['promo_card_setting']['preview_img']"
                  alt="">
                <div>
                  <div
                    style="font-size:16px">{{defaultData.template_struct.promotion_card.card_type_lst['all']['promo_card_setting']['product_description']}}</div>
                  <div class="promotion_card__left__selling">
                    <span>{{defaultData.template_struct.promotion_card.card_type_lst['all']['promo_card_setting']['product_points'][0].name}}</span>
                    <!--                               <span *ngIf="index+1<defaultData.template_struct.promotion_card.card_type_lst['all']['promo_card_setting']['product_points'].length">、</span>-->

                  </div>
                </div>
              </div>
              <div class="promotion_card__right">
                <div>{{defaultData.template_struct.promotion_card.card_type_lst['all']['promo_card_setting']['call_to_action']}}</div>
              </div>
            </div>
            <div class="ml8">
              <a *ngIf="isShowCardSetting" (click)="changeOpenCard(false)">收起</a>
              <a *ngIf="!isShowCardSetting" (click)="changeOpenCard(true)">更改</a>
            </div>
          </div>
        </div>
        <app-card-template-section *ngIf="cardLoading&&isShowCardSetting"
                                   [promotionCard]="defaultData.template_struct.promotion_card.card_type_lst['all']"
                                   [actionList]="structConfig['creative']['promotion_card_action_button']['sub']"
                                   [checkError]="checkErrorTip.card_error_tip['all']"
                                   [useProductImg]="defaultData.template_struct.promotion_card.use_auto_create_product_image"></app-card-template-section>
      </ng-container>
    </ng-container>
    <div class="lab-row pl20 mb20 w100p"
         *ngIf="defaultData.template_struct.creative.bind_type.indexOf('OFFICIAL')!==-1||defaultData.template_struct.creative.bind_type.indexOf('SELF')!==-1">
      <label>抖音主页隐藏视频:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="defaultData.template_struct.creative.is_homepage_hide"
      >
        <ng-container>
          <label nz-radio-button [nzValue]="1">
            <span>隐藏</span>
          </label>
          <label nz-radio-button [nzValue]="0">
            <span>不隐藏</span>
          </label>
        </ng-container>
      </nz-radio-group>
    </div>
  </div>
  <div class="drawer-confirmbox">
    <button class="ml8" nz-button [nzType]="'default'" nzSize="small" (click)="closeSingelSettingDraw('adgroup')">
      <span>取消</span>
    </button>
    <button class="ml8" nz-button [nzType]="'primary'" nzSize="small" (click)="saveSingleEdit('adgroup')">
      <span>确认</span>
    </button>
  </div>
</nz-drawer>
<!--定向-->
<nz-drawer *ngIf="settingDrawerObj.audience"
           [nzVisible]="settingDrawerObj.audience"
           [nzWidth]="'1000px'"
           nzPlacement="right"
           nzTitle="定向包"
           (nzOnClose)="closeSingelSettingDraw('audience')"
>
  <nz-tabset [nzType]="'card'" [nzSelectedIndex]="curDeliveryIndex">
    <nz-tab class="mb20 w100p" nzTitle="选择定向包">
      <div class="drawer-content" style="height: calc(100vh - 230px);">
        <ng-container>
          <ng-container [ngTemplateOutlet]="target_template" [ngTemplateOutletContext]="{}"></ng-container>
        </ng-container>

        <div class="error-tip mt5 ml8" *ngIf="checkErrorTip.audience_template_id_lst.is_show">
          <i nz-icon nzType="close-circle" nzTheme="outline" style="color: red" class="mr5"></i>
          <span style="color: red;">{{ checkErrorTip.audience_template_id_lst.tip_text }}</span>
        </div>
      </div>
      <div class="drawer-confirmbox">
        <button class="ml8" nz-button [nzType]="'default'" nzSize="small" (click)="closeSingelSettingDraw('audience')">
          <span>取消</span>
        </button>
        <button class="ml8" nz-button [nzType]="'primary'" nzSize="small" (click)="saveSingleEdit('audience')">
          <span>确认</span>
        </button>
      </div>
    </nz-tab>
    <nz-tab class="mb20 w100p" nzTitle="新建定向包">
      <app-launch-target-basic-qc [promotionWay]="defaultData.template_struct.campaign.promotion_way" [curAccountList]="defaultData.chan_pub_id_lst" [targetType]="'basic'" (resultsChange)="createTargetNew($event)"></app-launch-target-basic-qc>
    </nz-tab>
  </nz-tabset>
</nz-drawer>
<nz-drawer *ngIf="isEditAudienceDraw"
           [nzVisible]="isEditAudienceDraw"
           [nzWidth]="'1000px'"
           nzPlacement="right"
           nzTitle="编辑定向包"
           (nzOnClose)="isEditAudienceDraw=false"
>
  <app-launch-target-basic-qc [promotionWay]="defaultData.template_struct.campaign.promotion_way" [curAccountList]="defaultData.chan_pub_id_lst" [audienceTemplateId]="editAudienceId" [targetType]="'basicEdit'" (resultsChange)="editTargetClose($event)"></app-launch-target-basic-qc>
</nz-drawer>
<!--创意素材-->
<nz-drawer *ngIf="settingDrawerObj.creative"
           [nzVisible]="settingDrawerObj.creative"
           [nzWidth]="'1200px'"
           nzPlacement="right"
           nzTitle="创意素材"
           (nzOnClose)="closeSingelSettingDraw('creative')"
>
  <div class="drawer-content">
    <div class="lab-row pl20 mb20 w100p">
      <label id="creative_mode"><span class="redStart">*</span>创意方式:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="popconObj.creative_material_mode"
      >
        <ng-container *ngFor="let option of structConfig['creative']['creative_material_mode']['sub']">
          <label nz-radio-button nzValue="{{option['value']}}"
                 *ngIf="(defaultData.template_struct.campaign.promotion_way!=='SIMPLE'&&(defaultData.template_struct.creative.bind_type.indexOf('OFFICIAL')!==-1||defaultData.template_struct.creative.bind_type.indexOf('SELF')!==-1)&&defaultData.template_struct.adgroup.external_action==='AD_CONVERT_TYPE_SHOPPING')||option['value']!=='PROGRAMMATIC_CREATIVE'"
                 nz-popconfirm [nzPopconfirmTitle]="'切换创意方式将清空所选素材，确认切换？'"
                 (nzOnCancel)="cancelPopcon('creative_material_mode','creative')"
                 (nzOnConfirm)="changeCreativeType(option.value)"
                 [nzPopconfirmTrigger]="defaultData.template_struct.creative.creative_material_mode===option.value?'null':'click'">
            <span>{{ option['label'] }}</span>
          </label>
        </ng-container>
      </nz-radio-group>
    </div>
    <div class="lab-row pl20 mb20 w100p"
         *ngIf="defaultData.template_struct.campaign.marketing_goal==='VIDEO_PROM_GOODS'">
      <label><span class="redStart">*</span>生成更多创意:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="popconObj.creative_auto_generate"
      >
        <ng-container *ngFor="let option of structConfig['creative']['creative_auto_generate']['sub']">
          <label nz-radio-button nzValue="{{option['value']}}"
                 *ngIf="((defaultData.template_struct.campaign.promotion_way==='SIMPLE'&&(defaultData.template_struct.creative.bind_type.indexOf('OFFICIAL')!==-1||defaultData.template_struct.creative.bind_type.indexOf('SELF')!==-1))&&option['value']!='0')&&(((defaultData.template_struct.creative.bind_type.indexOf('OFFICIAL')===-1&&defaultData.template_struct.creative.bind_type.indexOf('SELF')===-1))&&option['value']!='1')"
                 nz-popconfirm [nzPopconfirmTitle]="'切换生成更多创意将清空所选素材，确认切换？'"
                 (nzOnCancel)="cancelPopcon('creative_auto_generate','creative')"
                 (nzOnConfirm)="changeCreativeAutoType(option.value)"
                 [nzPopconfirmTrigger]="defaultData.template_struct.creative.creative_auto_generate===option.value?'null':'click'">
            <span>{{ option['label'] }}</span>
          </label>
        </ng-container>
      </nz-radio-group>
    </div>
    <div class="lab-row pl20 mb20 w100p" *ngIf="settingLoad">
      <label><span class="redStart">*</span>每组创意组配置:</label>
      <ng-container *ngFor="let idea of defaultData.template_struct.material.material_type_temp['limit']">
        <nz-input-number class="ml8 w80" [ngModel]="idea.num"
                         (ngModelChange)="checkCreativeNum($event,idea,defaultData.template_struct.material.material_type_temp)"
                         [nzMin]="idea.min" [nzStep]="1"></nz-input-number>
        <span class="ml8 mr10" style="line-height: 32px">个{{idea.label}};</span>
      </ng-container>
    </div>
    <div class="lab-row pl20 mb20 w100p"
         *ngIf="defaultData.template_struct.campaign.marketing_goal==='LIVE_PROM_GOODS'">
      <label><span class="redStart">*</span>创意类型:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="defaultData.template_struct.creative.is_use_aweme_live_room"
      >
        <label nz-radio-button [nzValue]="1">
          <span>直播间画面</span>
        </label>
        <label nz-radio-button [nzValue]="0">
          <span>视频</span>
        </label>
      </nz-radio-group>
    </div>
    <div class="lab-row pl20 mb20 w100p"
         *ngIf="defaultData.template_struct.creative.creative_material_mode!=='PROGRAMMATIC_CREATIVE'">
      <label><span class="redStart">*</span>分素材选择标题:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="defaultData.template_struct.material.by_material_set_title"
        (ngModelChange)="changeTitleByChannel($event,'material')"
      >
        <label nz-radio-button [nzValue]="true"
               [nzDisabled]="defaultData.template_struct.creative.creative_material_mode==='PROGRAMMATIC_CREATIVE'">
          <span>是</span>
        </label>
        <label nz-radio-button [nzValue]="false">
          <span>否</span>
        </label>
      </nz-radio-group>
    </div>
    <div class="lab-row pl20 mb20 w100p"
         *ngIf="defaultData.template_struct.creative.creative_material_mode==='PROGRAMMATIC_CREATIVE'">
      <label><span class="redStart">*</span>分创意组选择标题:</label>
      <nz-radio-group
        class="ml8"
        [(ngModel)]="defaultData.template_struct.material.by_creative_group_set_title"
        (ngModelChange)="changeTitleByChannel($event,'group')"
      >
        <label nz-radio-button [nzValue]="true">
          <span>是</span>
        </label>
        <label nz-radio-button [nzValue]="false">
          <span>否</span>
        </label>
      </nz-radio-group>
    </div>
    <ng-container *ngIf="!defaultData.template_struct.material.by_channel_set_material">
      <div class="lab-row pl20 mb20 w100p">
        <label><span class="redStart">*</span>素材选取:</label>
        <div style="flex:1">
          <ng-container *ngIf="defaultData.template_struct.material.material_type_lst.all.materials.length>0">
            <ng-container *ngIf="defaultData.template_struct.material.by_material_set_title">
              <ng-container
                *ngFor="let creative of defaultData.template_struct.material.material_type_lst.all.materials;let index=index">
                <ng-container [ngTemplateOutlet]="creativeTitleGroupShow"
                              [ngTemplateOutletContext]="{sourceData:defaultData.template_struct.material.material_type_lst['all'].materials,materialList:creative,index:index}"></ng-container>
              </ng-container>
            </ng-container>
            <ng-container *ngIf="!defaultData.template_struct.material.by_material_set_title">
              <ng-container
                *ngFor="let creative of defaultData.template_struct.material.material_type_lst.all.materials;let index=index">
                <ng-container [ngTemplateOutlet]="creativeGroupShow"
                              [ngTemplateOutletContext]="{sourceData:defaultData.template_struct.material.material_type_lst['all'].materials,materialList:creative,index:index}"></ng-container>
              </ng-container>
            </ng-container>
          </ng-container>
          <button class="ml8 mr8" nz-button [nzType]="'default'"
                  (click)="addCreativeGroup(defaultData.template_struct.material.material_type_lst.all.materials)">
            <span>添加创意组</span>
          </button>
          <div class="error-tip mt5 ml8" *ngIf="checkErrorTip.material_lst.is_show">
            <i nz-icon nzType="close-circle" nzTheme="outline" style="color: red" class="mr5"></i>
            <span style="color: red;">{{ checkErrorTip.material_lst.tip_text }}</span>
          </div>
          <div class="error-tip mt5 ml8" *ngIf="checkErrorTip.material_title_lst.is_show">
            <i nz-icon nzType="close-circle" nzTheme="outline" style="color: red" class="mr5"></i>
            <span style="color: red;">{{ checkErrorTip.material_title_lst.tip_text }}</span>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
  <div class="drawer-confirmbox">
    <button class="ml8" nz-button [nzType]="'default'" nzSize="small" (click)="closeSingelSettingDraw('creative')">
      <span>取消</span>
    </button>
    <button class="ml8" nz-button [nzType]="'primary'" nzSize="small" (click)="saveSingleEdit('creative')">
      <span>确认</span>
    </button>
  </div>
</nz-drawer>
<!--创意标题-->
<!--<nz-drawer *ngIf="settingDrawerObj.title"-->
<!--  [nzVisible]="settingDrawerObj.title"-->
<!--  [nzWidth]="'1200px'"-->
<!--  nzPlacement="right"-->
<!--  nzTitle="创意标题"-->
<!--  (nzOnClose)="closeSingelSettingDraw('title')"-->
<!--&gt;-->
<!--  <div class="drawer-content">-->
<!--    <nz-tabset [nzType]="'card'" [nzSelectedIndex]="curDeliveryIndex">-->
<!--      <nz-tab class="mb20 w100p" nzTitle="item.convert_channel_name">-->
<!--      </nz-tab>-->
<!--    </nz-tabset>-->
<!--  </div>-->
<!--  <div class="drawer-confirmbox">-->
<!--    <button class="ml8" nz-button [nzType]="'default'" nzSize="small" (click)="closeSingelSettingDraw('title')">-->
<!--      <span>取消</span>-->
<!--    </button>-->
<!--    <button class="ml8" nz-button [nzType]="'primary'" nzSize="small" (click)="saveSingleEdit('title')">-->
<!--      <span>确认</span>-->
<!--    </button>-->
<!--  </div>-->
<!--</nz-drawer>-->
<!--分类标签-->
<nz-drawer *ngIf="settingDrawerObj.tags"
           [nzVisible]="settingDrawerObj.tags"
           [nzWidth]="'1000px'"
           nzPlacement="right"
           nzTitle="创意分类标签"
           (nzOnClose)="closeSingelSettingDraw('tags')"
>
  <div class="drawer-content">
    <div>
      <button nz-button [nzType]="'primary'" (click)="addCreativeTag()" class="mr10">
        <span>新增分类标签</span>
      </button>
    </div>
    <div class="custom-collapse mt20">
      <ng-container *ngFor="let creativeTag of defaultData.template_struct.creative.industry_keywords_lst;let index=index">
        <div class="custom-collapse-item">
          <div class="operate">
            <div class="name-edit-wrapper">
              <div class="name-wrapper">
                <input class="w300" nz-input [placeholder]="'请输入创意分类标签名称'" [(ngModel)]="creativeTag.name" />
              </div>
            </div>
            <div class="operate-option">
              <a class="ml8" (click)="copyCreativeTag(creativeTag)">复制</a>
              <span class="ml8" nz-popconfirm [nzPopconfirmTitle]="'确定要删除吗？'" (nzOnConfirm)="deleteCreativeTag(index)">删除</span></div>
          </div>
          <div class="detail">
            <div class="lab-row pl20 mb20 w100p">
              <label class="w80"><span *ngIf="defaultData.template_struct.campaign.promotion_way!=='SIMPLE'"
                           class="redStart">*</span>创意分类:</label>
              <div>
                <nz-cascader class="w_full ml8"
                             [nzOptions]="categoryList"
                             [(ngModel)]="creativeTag.third_industry_id_list">
                </nz-cascader>
                <div class="error-tip mt5 ml8" *ngIf="checkErrorTip.third_industry_id_list.is_show&&!creativeTag.third_industry_id_list.length">
                  <i nz-icon nzType="close-circle" nzTheme="outline" style="color: red" class="mr5"></i>
                  <span style="color: red;">{{ checkErrorTip.third_industry_id_list.tip_text }}</span>
                </div>
              </div>
            </div>
            <div id="creative_label" class="lab-row pl20 mb20 w100p">
              <label class="w80"><span *ngIf="defaultData.template_struct.campaign.promotion_way!=='SIMPLE'"
                           class="redStart">*</span>创意标签:</label>
              <div>
                <div style="display: flex;">
                  <div class="w_full ml8 mr8">
                    <input
                      nz-input
                      type="text"
                      [(ngModel)]="creativeTag.inputValue"
                      (keyup.enter)="AddTags(creativeTag)"
                      placeholder="最多20个标签，每个不超过20个字符，可空格分隔"
                    />
                  </div>
                  <a (click)="AddTags(creativeTag)"><span>添加</span></a>
                </div>
                <div class="error-tip mt5 ml8" *ngIf="checkErrorTip.ad_keywords.is_show&&!creativeTag['ad_keywords'].length">
                  <i nz-icon nzType="close-circle" nzTheme="outline" style="color: red" class="mr5"></i>
                  <span style="color: red;">{{ checkErrorTip.ad_keywords.tip_text }}</span>
                </div>
                <div class="mt20" style="display: flex;"
                     *ngIf="creativeTag['ad_keywords'].length">
                  <div class="tags-box w_full ml8 mr8">
                    <div class="tags-box-title">
                      <span>已选</span>
                      <a (click)="clearTags(creativeTag)"><span>清空</span></a>
                    </div>
                    <div class="tags-box-content">
                      <div style="border-radius: 5px;" *ngFor="let item of creativeTag.ad_keywords; let index = index;">
                        <span>{{item}}</span>
                        <a style="color: red; float: right;"><i nz-icon nzType="close" nzTheme="outline"
                                                                (click)="deleteTag(creativeTag,index)"></i></a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
  <div class="drawer-confirmbox">
    <button class="ml8" nz-button [nzType]="'default'" nzSize="small" (click)="closeSingelSettingDraw('tags')">
      <span>取消</span>
    </button>
    <button class="ml8" nz-button [nzType]="'primary'" nzSize="small" (click)="saveSingleEdit('tags')">
      <span>确认</span>
    </button>
  </div>
</nz-drawer>
<!--商品-->
<nz-drawer *ngIf="settingDrawerObj.product"
           [nzVisible]="settingDrawerObj.product"
           [nzWidth]="'1200px'"
           nzPlacement="right"
           nzTitle="商品"
           (nzOnClose)="closeSingelSettingDraw('product')"
>
  <div class="drawer-content">
    <ng-container *ngFor="let item of curAccountList">
      <ng-container [ngTemplateOutlet]="product_template"
                    [ngTemplateOutletContext]="{data:item,productData:item.productList,result:defaultData.template_struct.adgroup.product_aweme_id_lst[item.chan_pub_id]}"></ng-container>
    </ng-container>
  </div>
  <div class="drawer-confirmbox">
    <button class="ml8" nz-button [nzType]="'default'" nzSize="small" (click)="closeSingelSettingDraw('product')">
      <span>取消</span>
    </button>
    <button class="ml8" nz-button [nzType]="'primary'" nzSize="small" (click)="saveSingleEdit('product')">
      <span>确认</span>
    </button>
  </div>
</nz-drawer>

<ng-template #target_template>
  <div>
    <nz-input-group class="ml8 w300" [nzSuffix]="suffixIconSearch">
      <input type="text" nz-input placeholder="请输入关键字" [(ngModel)]="searchAudienceName"  (blur)="getChildTargetList()"/>
    </nz-input-group>
    <ng-template #suffixIconSearch>
      <i nz-icon nzType="search"></i>
    </ng-template>
  </div>

  <nz-table class="mt20 ml8" #borderedTable nzBordered [nzShowPagination]="false" [nzData]="curTargetList"
            [nzScroll]="{x:'662px', y: '400px' }" [nzPageSize]="5000">
    <thead>
    <tr>
      <th [nzWidth]="'62px'" nzShowCheckbox [(nzChecked)]="_allChecked"
          (nzCheckedChange)="_checkAll(curTargetList,$event)">
      <th nzWidth="200px">名称</th>
      <th nzWidth="200px">定向包类型</th>
      <th nzWidth="200px">创建时间</th>
      <th nzWidth="200px">操作</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let data of borderedTable.data">
      <td nzShowCheckbox [(nzChecked)]="data.checked" (nzCheckedChange)="_refreshStatus(curTargetList,$event)">
      <td>{{data.audience_template_name}}</td>
      <td>{{data.promotion_way === "STANDARD" ? '专业版' : '极速版'}}</td>
      <td>{{data.create_time}}</td>
      <td>
        <a href="javascript:" (click)="openEditTargetVisible('basicEdit',data)">编辑</a>
      </td>
    </tr>
    </tbody>
  </nz-table>
</ng-template>

<ng-template #titleSelectedShow let-titles="titles">
  <div class="ml8 mt8 title-selected-show-container">
    <div class="title-action">
      <div>已选（{{titles.length}}）</div>
      <div>
        <button class="mr8" nz-button [nzType]="'default'" [nzSize]="'small'"
                (click)="clearAllSelected(titles,'title')">
          <span>清空</span>
        </button>
        <button class=" mr8" nz-button [nzType]="'default'" [nzSize]="'small'" (click)="addLaunchTitle(titles)">
          <span>添加标题</span>
        </button>
      </div>
    </div>
    <div class="title-item-wrapper mt10">
      <div class="title-item" *ngFor="let title of titles;let idx=index">
        <span class="txt" title="{{title}}">{{title}}</span>
        <i nz-icon nzType="close" nzTheme="outline" class="hand" (click)="clearSingleSelected(titles,idx,'title')"></i>
      </div>

    </div>
  </div>

</ng-template>
<ng-template #creativeGroupShow let-sourceData="sourceData" let-materialList="materialList" let-index="index"
             let-cssType="cssType">
  <div class="ml8 mr8 creative-container">
    <div class="creative-group">
      <div class="creative-group-header">
        <span class="creative-group-header-name">创意组{{index + 1}}</span>
        <div style="position: absolute;right: 20px;">
          <span class="creative-group-header-btn mr8" (click)="copyCreativeGroup(materialList,sourceData)"><a><i nz-icon
                                                                                                                 nzType="copy"
                                                                                                                 nzTheme="outline"></i></a></span>
          <span class="creative-group-header-btn mr8" (click)="deleteCreativeGroup(index,sourceData)"><a><i nz-icon
                                                                                                            nzType="delete"
                                                                                                            nzTheme="outline"></i></a></span>
        </div>
      </div>
      <div class="creative-group-body">
        <div class="add-btn">
          <button *ngIf="materialList.curIndex<materialList.limit.length" class="mr8 pull-right" nz-button
                  [nzType]="'primary'" [nzSize]="'small'"
                  (click)="addCreative(materialList.limit[materialList.curIndex],defaultData.template_struct.material.material_type_temp.limit[materialList.curIndex])"
                  [disabled]="defaultData.template_struct.material.material_type_temp.limit[materialList.curIndex].num===0">
            <i nz-icon nzType="plus" nzTheme="outline"></i>
            <span>添加素材</span>
          </button>
          <button
            *ngIf="defaultData.template_struct.creative.creative_material_mode==='PROGRAMMATIC_CREATIVE'&&defaultData.template_struct.material.by_creative_group_set_title&&materialList.curIndex>=materialList.limit.length"
            class="mr8 pull-right" nz-button [nzType]="'primary'" [nzSize]="'small'"
            (click)="addLaunchTitle(materialList['title'],10)">
            <i nz-icon nzType="plus" nzTheme="outline"></i>
            <span>添加标题</span>
          </button>
        </div>
        <div style="display: flex">
          <nz-tabset class="ml8 card-tab" [(nzSelectedIndex)]="materialList.curIndex">
            <ng-container *ngFor="let idea of materialList['limit'];let idex=index">
              <nz-tab
                [nzTitle]="idea.label+idea.list.length+'/'+defaultData.template_struct.material.material_type_temp.limit[idex].num">
                <div class="creative-item-wrapper">
                  <ng-container *ngIf="idea.list&&idea.list.length">
                    <div class="ml10 mt10 mb10 creative-item" *ngFor="let material of idea.list;let idx=index">
                      <div class="creative-card-box">
                        <div class="creative-card">
                          <div class="img-content creative-preview">
                            <img class="cover" [src]="material['preview_img']" nz-popover
                                 [nzPopoverContent]="contentTemplate" [nzPopoverOverlayClassName]="'image-drop-class'"
                                 nzPopoverPlacement="topLeft" nzPopoverTrigger="click">
                            <ng-template #contentTemplate>
                              <div class="image-cnt-drop">
                                <img *ngIf="idea.type==='image'" [src]="material['preview_img']">
                                <a *ngIf="idea.type==='video'" target="_blank" [href]="material['preview_video']">
                                  <video poster="{{material['preview_img']}}" [src]="material['preview_video']"
                                         controls="controls" controlslist="nodownload"></video>
                                </a>
                              </div>
                            </ng-template>
                          </div>
                          <div class="creative-name">{{material['material_name']}}</div>
                        </div>
                        <!--                        <div class="btn-wrapper btn-center" *ngIf="defaultData.template_struct.material.screenshot_setting_type === 'material'">-->
                        <!--                          <button *ngIf="!material.screenshot_setting || !material.screenshot_setting['preview_img']" nz-button nzType="dashed" (click)="addCover(material,cssType)">设置封面</button>-->
                        <!--                          <div *ngIf="material.screenshot_setting && material.screenshot_setting['preview_img']" class="image-preview material-preview">-->
                        <!--                            <button class="update-cover-box" nz-button nzType="dashed" (click)="addCover(material,cssType)">修改封面</button>-->
                        <!--                            <div class="img-content">-->
                        <!--                              <img class="cover size img" [src]="material['screenshot_setting']['preview_img']" >-->
                        <!--                            </div>-->
                        <!--                          </div>-->
                        <!--                        </div>-->
                      </div>
                      <i nz-icon class="close-icon" nzType="close-circle" nzTheme="outline"
                         (click)="clearSingleSelected(idea.list,idx,'material')"></i>
                    </div>
                  </ng-container>
                </div>
              </nz-tab>
            </ng-container>
            <ng-container
              *ngIf="defaultData.template_struct.creative.creative_material_mode==='PROGRAMMATIC_CREATIVE'&&defaultData.template_struct.material.by_creative_group_set_title">
              <nz-tab [nzTitle]="'标题'+(materialList.title?materialList.title.length:0)+'/10'">
                <div class="creative-item-wrapper">
                  <ng-container *ngIf="materialList['title'] && materialList['title'].length>0"
                                [ngTemplateOutlet]="titleSelectedShow"
                                [ngTemplateOutletContext]="{titles:materialList['title']}">
                  </ng-container>
                </div>
              </nz-tab>
            </ng-container>
          </nz-tabset>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #creativeTitleGroupShow let-sourceData="sourceData" let-materialList="materialList" let-index="index"
             let-cssType="cssType">
  <div class="ml8 mr8 creative-container">
    <div class="creative-group">
      <div class="creative-group-header">
        <span class="creative-group-header-name">创意组{{index + 1}}</span>
        <div style="position: absolute;right: 20px;">
          <span class="creative-group-header-btn mr8" (click)="copyCreativeGroup(materialList,sourceData)"><a><i nz-icon
                                                                                                                 nzType="copy"
                                                                                                                 nzTheme="outline"></i></a></span>
          <span class="creative-group-header-btn mr8" (click)="deleteCreativeGroup(index,sourceData)"><a><i nz-icon
                                                                                                            nzType="delete"
                                                                                                            nzTheme="outline"></i></a></span>
        </div>
      </div>
      <div class="creative-group-body">
        <button class="mr8 pull-right add-btn" nz-button [nzType]="'primary'" [nzSize]="'small'"
                (click)="addCreative(materialList.limit[materialList.curIndex],defaultData.template_struct.material.material_type_temp.limit[materialList.curIndex])"
                [disabled]="defaultData.template_struct.material.material_type_temp.limit[materialList.curIndex].num===0">
          <i nz-icon nzType="plus" nzTheme="outline"></i>
          <span>添加素材</span>
        </button>
        <div>
          <nz-tabset class="ml8 card-tab" [(nzSelectedIndex)]="materialList.curIndex">
            <ng-container *ngFor="let idea of materialList['limit'];let idex=index">
              <nz-tab
                [nzTitle]="idea.label+idea.list.length+'/'+defaultData.template_struct.material.material_type_temp.limit[idex].num">
                <div class="creative-item-wrapper">
                  <ng-container *ngIf="idea.list&&idea.list.length">
                    <div class="ml10 mt10 mb10 creative-item" *ngFor="let material of idea.list;let idx=index">
                      <div class="creative-card-box">
                        <div class="creative-card">
                          <div class="img-content creative-preview">
                            <img class="cover" [src]="material['preview_img']" nz-popover
                                 [nzPopoverContent]="contentTemplate" [nzPopoverOverlayClassName]="'image-drop-class'"
                                 nzPopoverPlacement="topLeft" nzPopoverTrigger="click">
                            <ng-template #contentTemplate>
                              <div class="image-cnt-drop">
                                <img *ngIf="idea.type==='image'" [src]="material['preview_img']">
                                <a *ngIf="idea.type==='video'" target="_blank" [href]="material['preview_video']">
                                  <video poster="{{material['preview_img']}}" [src]="material['preview_video']"
                                         controls="controls" controlslist="nodownload"></video>
                                </a>
                              </div>
                            </ng-template>
                          </div>
                          <div class="creative-name">{{material['material_name']}}</div>
                          <div class="creative-title">
                            <!--                                          <nz-textarea-count [nzMaxCharacterCount]="55">-->
                            <!--                                            <textarea rows="1" nz-input [(ngModel)]="material['title'][0]"></textarea>-->
                            <!--                                          </nz-textarea-count>-->
                            <button class="mr8" nz-button [nzType]="'default'" [nzSize]="'small'"
                                    *ngIf="!(material['title'] && material['title'].length>0)"
                                    (click)="addLaunchTitle(material['title'],1)">
                              <span>添加标题</span>
                            </button>
                            <ng-container *ngIf="material['title'] && material['title'].length>0"
                                          [ngTemplateOutlet]="titleSelectedShow"
                                          [ngTemplateOutletContext]="{titles:material['title']}">
                            </ng-container>
                          </div>
                        </div>
                      </div>
                      <i nz-icon class="close-icon" nzType="close-circle" nzTheme="outline"
                         (click)="clearSingleSelected(idea.list,idx,'material')"></i>
                    </div>
                  </ng-container>
                </div>
              </nz-tab>
            </ng-container>
          </nz-tabset>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #product_template let-data="data" let-productData="productData" let-result="result">
  <nz-table class="ml8" nzSize="small" #borderedTable nzBordered
            [nzData]="data.productList"
            nzShowSizeChanger
            [nzPageSizeOptions]="[30, 50, 100,500]"
            [nzSize]="'small'"
            [nzFrontPagination]="false"
            [(nzPageSize)]="pageSize"
            [(nzPageIndex)]="currentPage"
            (nzPageIndexChange)="getChannelList(data)"
            (nzPageSizeChange)="getChannelList(data,true)"
            [nzTotal]="total"
            [nzScroll]="{x:'820px', y: '400px' }">
    <thead>
    <tr>
      <th [nzWidth]="'50px'">
      <th nzWidth="300px">
        <div style="line-height: 44px">
          <span>商品信息</span>
          <nz-input-group class="ml20 w200" [nzSuffix]="suffixIconSearch">
            <input type="text" nz-input placeholder="请输入商品名称" [(ngModel)]="searchProductName"
                   (blur)="getChannelList(data)"/>
          </nz-input-group>
          <ng-template #suffixIconSearch>
            <i nz-icon nzType="search"></i>
          </ng-template>
        </div>
      </th>
      <th nzWidth="80px">分类</th>
      <th nzWidth="80px">售价</th>
      <th nzWidth="80px">库存</th>
      <th nzWidth="80px">好评率</th>
      <th nzWidth="150px">上架时间</th>
    </tr>
    </thead>
    <tbody>
    <ng-container *ngFor="let data of borderedTable.data">
      <tr>
        <td nzShowCheckbox [(nzChecked)]="data.checked" (nzCheckedChange)="_checkSingleProduct(data,$event,result)"
            [nzDisabled]="!data.checked&&result.product_id.length>0">
        <td>
          <div class="product-image-cell">
            <div class="image-info">
              <div class="image-poster">
                <img [src]="data['product_img']" nz-popover [nzPopoverContent]="contentTemplate"
                     [nzPopoverOverlayClassName]="'image-drop-class'" nzPopoverPlacement="topLeft"
                     nzPopoverTrigger="click">
                <ng-template #contentTemplate>
                  <div class="image-cnt-drop">
                    <img [src]="data['product_img']">
                  </div>
                </ng-template>
              </div>
              <div class="image-title">
                {{data['product_name']}}<br>
                ID: {{data['product_id']}}
              </div>
            </div>
          </div>
        </td>
        <td>{{data.category_name}}</td>
        <td>{{data.market_price}}</td>
        <td>{{data.inventory}}</td>
        <td>{{data.product_rate}}%</td>
        <td>{{data.sale_time}}</td>
      </tr>
    </ng-container>
    </tbody>
  </nz-table>
</ng-template>
